<!doctype html>
<html lang="ko" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-learn/Escape Hatches/synchronizing-with-effects">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Effect 를 동기화하기 | React Docs KOR</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://line-next-level.github.io/React-Docs-KOR/docs/learn/Escape Hatches/synchronizing-with-effects"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Effect 를 동기화하기 | React Docs KOR"><meta data-rh="true" name="description" content="몇 컴포넌트들은 외부 시스템과 동기화할 필요가 있습니다. 예를 들어, React 상태에 기반한 React가 아닌 컴포넌트를 제어하거나, 서버 연결을 설정하거나, 화면에 컴포넌트나 나타날 때 분석 로그를 보내고 싶을 수 있습니다."><meta data-rh="true" property="og:description" content="몇 컴포넌트들은 외부 시스템과 동기화할 필요가 있습니다. 예를 들어, React 상태에 기반한 React가 아닌 컴포넌트를 제어하거나, 서버 연결을 설정하거나, 화면에 컴포넌트나 나타날 때 분석 로그를 보내고 싶을 수 있습니다."><link data-rh="true" rel="icon" href="/React-Docs-KOR/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://line-next-level.github.io/React-Docs-KOR/docs/learn/Escape Hatches/synchronizing-with-effects"><link data-rh="true" rel="alternate" href="https://line-next-level.github.io/React-Docs-KOR/docs/learn/Escape Hatches/synchronizing-with-effects" hreflang="ko"><link data-rh="true" rel="alternate" href="https://line-next-level.github.io/React-Docs-KOR/docs/learn/Escape Hatches/synchronizing-with-effects" hreflang="x-default"><link rel="stylesheet" href="/React-Docs-KOR/assets/css/styles.2d3a33e4.css">
<link rel="preload" href="/React-Docs-KOR/assets/js/runtime~main.16dcfed8.js" as="script">
<link rel="preload" href="/React-Docs-KOR/assets/js/main.ae80d2f5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a href="#" class="skipToContent_fXgn">본문으로 건너뛰기</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/React-Docs-KOR/"><div class="navbar__logo"><img src="/React-Docs-KOR/img/logo.svg" alt="React Docs Beta KOR" class="themedImage_ToTc themedImage--light_HNdA"><img src="/React-Docs-KOR/img/logo.svg" alt="React Docs Beta KOR" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">React Docs Beta KOR</b></a><a class="navbar__item navbar__link" href="/React-Docs-KOR/docs/learn/installation/add-react-to-website">learn</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="맨 위로 스크롤하기" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/React-Docs-KOR/docs/learn/Quick Start/thinking-in-react">GET STARTED</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/React-Docs-KOR/docs/learn/Describing the UI/describing-the-ui">LEARN REACT</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/React-Docs-KOR/docs/learn/Describing the UI/describing-the-ui">Describing the UI</a><button aria-label="접을 수 있는 사이드바 분류 &#x27;Describing the UI&#x27; 접기(펼치기)" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/React-Docs-KOR/docs/learn/Adding Interactivity/adding-interactivity">Adding Interactivity</a><button aria-label="접을 수 있는 사이드바 분류 &#x27;Adding Interactivity&#x27; 접기(펼치기)" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/React-Docs-KOR/docs/learn/Managing State/managing-state">Managing State</a><button aria-label="접을 수 있는 사이드바 분류 &#x27;Managing State&#x27; 접기(펼치기)" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/escape-hatches">Escape Hatches</a><button aria-label="접을 수 있는 사이드바 분류 &#x27;Escape Hatches&#x27; 접기(펼치기)" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/referencing-values-with-refs">Ref를 이용해 값을 기억하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/manipulating-the-dom-with-refs">Ref를 사용해 돔 조작하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/synchronizing-with-effects">Effect 를 동기화하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/you-might-not-need-an-effect">Effect가 필요하지 않을 가능성</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/lifecycle-of-reactive-effects">React적인 Effect의 생명주기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/seperating-events-from-effects">Effects에서 이벤트 분리하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/removing-effect-dependencies">Effect 의존성을 제거하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/React-Docs-KOR/docs/learn/Escape Hatches/reusing-logic-with-custom-hooks">커스텀 훅으로 로직 재사용하기</a></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="홈" class="breadcrumbs__link" href="/React-Docs-KOR/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">LEARN REACT</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/React-Docs-KOR/docs/learn/Escape Hatches/escape-hatches"><span itemprop="name">Escape Hatches</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Effect 를 동기화하기</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">이 페이지에서</button></div><div class="theme-doc-markdown markdown"><h1>Effect 를 동기화하기</h1><p>몇 컴포넌트들은 외부 시스템과 동기화할 필요가 있습니다. 예를 들어, React 상태에 기반한 React가 아닌 컴포넌트를 제어하거나, 서버 연결을 설정하거나, 화면에 컴포넌트나 나타날 때 분석 로그를 보내고 싶을 수 있습니다.
<em>Effects</em>는 렌더링 후에 코드를 실행해서 React 밖의 시스템과 컴포넌트를 동기화할 수 있습니다.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>여러분이 배울 것</div><div class="admonitionContent_S0QG"><ul><li>Effects가 무엇인지</li><li>Effects가 이벤트와 어떻게 다른지</li><li>컴포넌트 내부에 Effect를 선언하는 방법</li><li>불필요하게 Effects를 재실행하는 것을 건너뛰는 방법</li><li>개발에서 Effects가 두 번 실행되는 이유와 그것을 고치는 방법 </li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="effects는-무엇이고-이벤트와-어떻게-다를까요">Effects는 무엇이고 이벤트와 어떻게 다를까요?<a class="hash-link" href="#effects는-무엇이고-이벤트와-어떻게-다를까요" title="제목으로 바로 가기">​</a></h2><p>Effects로 들어가기 전에, React 컴포넌트 안의 두 가지 로직와 친숙해야 할 필요가 있습니다:</p><ul><li><p><strong>코드 렌더링</strong>(<a href="https://beta.reactjs.org/learn/describing-the-ui" target="_blank" rel="noopener noreferrer">UI 묘사하기</a>에서 소개된)은 컴포넌트의 상위 레벨에 위치합니다.
prop과 상태를 받고 변형시킨 다음에 화면에서 볼 수 있도록 JSX를 반환하는 곳입니다.
<a href="https://beta.reactjs.org/learn/keeping-components-pure" target="_blank" rel="noopener noreferrer">코드를 렌더링하는 것은 반드시 순수해야 합니다.</a>
수학 공식 처럼, 결과만을 <em>계산</em>하고 다른 어떤 것도 해서는 안됩니다.</p></li><li><p><strong>이벤트 핸들러</strong>(<a href="https://beta.reactjs.org/learn/adding-interactivity" target="_blank" rel="noopener noreferrer">인터랙티비티 추가하기</a>에서 소개된)는
컴포넌트 내에서 컴포넌트를 계산하는 것 이외의 것들을 하는 중첩된 함수입니다.
이벤트 핸들러는 입력 필드를 업데이터하고, 제품을 사서 HTTP POST 요청을 보내거나 다른 화면로 사용자를 이끌 수 있습니다.
이벤트 핸들러는 (프로그램의 상태를 바꾸는)&quot;<a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)" target="_blank" rel="noopener noreferrer">부작용</a>&quot;
이 있고 특정한 사용자의 행동으로 일어납니다(예를 들어, 버튼을 클릭하거나 타이핑하는 것).</p></li></ul><p>때떄로 이것만으로는 충분하지 않습니다. 스크린에 보일 떄마다 채팅 서버에 연결하는 <code>ChatRoom</code> 컴포넌트를 고려해보세요.
서버에 연결하는 것은 순수한 계산이 아니기 떄문에 (부작용) 렌더링 동안에는 일어날 수 없습니다.
그러나, 클릭 한 번으로 인해 <code>ChatRoom</code>이 표시되는 특정 이벤트는 없습니다.</p><p><strong>Effect를 사용하면 특정 이벤트를 사용하는 것 이외에 렌더링으로 일어나는 부작용을 명시할 수 있습니다.</strong>
채팅룸 안에서 메세지를 보내는 것은 특정 버튼을 클릭해서 사용자가 일으키기 떄문에 <em>이벤트</em>입니다.
그러나, 서버 연결을 설정하는 것은 컴포넌트가 보이도록 하는 상호작용과 무관하게 일어날 필요가 있기 때문에 <em>Effect</em>입니다.
Effect는 화면 업데이트 후에 <!-- -->[렌더링 과정]<!-- -->(rendering process)의 끝에 일어납니다.
React 컴포넌트와 다른 외부 시스템(네트워크나 다른 라이브러리)을 동기화하기에 적기입니다.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>이 텍스트에서 대문자 &quot;Effect&quot;는 위에서 설명한 React에 한정된 정의를 의미합니다. 예시: 렌더링에서 발생한 부작용(side effect).
더 넓은 프로그래밍 개념을 가리키기 위해서는 &quot;부작용&quot;이라고 부를 것입니다.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="effect가-필요-없을-수도-있습니다">Effect가 필요 없을 수도 있습니다.<a class="hash-link" href="#effect가-필요-없을-수도-있습니다" title="제목으로 바로 가기">​</a></h2><p><strong>컴포넌트에 급하게 Effect를 추가하지 마세요.</strong> Effect는 보통 React 코드의 &quot;단계에서 벗어나고&quot; <em>외부</em> 시스템과 동기화하기 위해 사용된다는 것을 유념하세요.
이는 브라우저 API, 위젯, 네트워크 등등을 포함합니다. Effect가 다른 상테에 의존하는 어떤 상태를 조정한다면, <a href="https://beta.reactjs.org/learn/you-might-not-need-an-effect" target="_blank" rel="noopener noreferrer">Effect가 필요 없을 수 있습니다.</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="effect를-작성하는-방법">Effect를 작성하는 방법<a class="hash-link" href="#effect를-작성하는-방법" title="제목으로 바로 가기">​</a></h2><p>Effect를 작성하기 위해서는 다음 세 단계를 따르세요:</p><ol><li><p><strong>Effect를 선언하세요.</strong> 기본적으로 Effect는 렌더링 다음에 일어납니다.</p></li><li><p><strong>Effect 의존도를 명시하세요.</strong> 대부분의 Effect는 모든 렌더링 후에 일어나기 보다 <em>필요한</em> 시점 이후에 다시 싱행되어야 합니다.
예를 들어, fade-in 애니메이션은 컴포넌트가 나타날 때에만 작동해야 합니다.
채팅방을 연결하고 끊는 것은 컴포넌트가 나타나고 사라질 때만 일어나거나, 채링방이 변할 때만 일어나야 하니다.
이것을 의존성을 명시해서 조절하는 방법을 배울 것입니다.</p></li><li><p><strong>필요하면 치우는 과정을 추가하세요.</strong> 어떤 이펙트들은 작동할 때마다 멈추고, 되돌리고, 지우는 방법을 명시할 필요가 있습니다/
예를 들어, &quot;연결&quot;은 &quot;연결해제&quot;가 필요하고, &quot;구독&quot;은 &quot;구독 해지&quot;가 필요하고, &quot;새로 고침&quot;은 &quot;취소나 &quot;무시&quot;가 필요합니다. <em>cleanup</em>함수를 반환해서 이러한 작업을 하는 방법을 배울 것입니다.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1단계-effect를-선언하세요">1단계: Effect를 선언하세요.<a class="hash-link" href="#1단계-effect를-선언하세요" title="제목으로 바로 가기">​</a></h2><p>컴포넌트 안에 Effect를 선언하기 위해서는 React에서 <code>[useEffect 훅](https://beta.reactjs.org/reference/react/useEffect)</code>을 임포트해야 합니다.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그리고 나서, 컴포넌트의 최상단에서 호출하고 Effect 안에 코드를 작성하세요:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">MyComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 여기 코드는 *모든* 렌터링 후에 동작합니다.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>컴포넌트가 렌더링할 때마다, 리액트는 스크린을 업데이트하고 <em>그리고 나서</em> <code>useEffect</code> 안의 코드를 실행합니다.
다른 말로, <code>useEffect</code>는 <strong>그 렌더링이 스크린에 반영될 떄까지 코드의 일부가 동작하는 것을 &quot;연기&quot;시킵니다.</strong></p><p>외부 시스템과 동기화하기 위해 Effect를 사용하는 방법을 알아봅시다.
<code>&lt;VideoPlayer/&gt;</code> 컴포넌트를 생각해봅시다. 이 컴포넌트에 <code>isPlaying</code> prop을 전달해 비디오를 실행하고 멈추는 것을 조절할 수 있다면 멋질 것입니다. </p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">VideoPlayer</span><span class="token plain"> isPlaying</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>여러분이 직접 만든 <code>VideoPlayer</code> 컴포넌트는 브라우저에 내장되어있는 <code>[&lt;video&gt;](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video)</code> 태그를 렌더링합니다.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">VideoPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> src</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> isPlaying </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// TODO: isPlaying 으로 뭔가를 해보세요. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">video src</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그러나, 브라우저의 <code>&lt;video&gt;</code>태그는 <code>isPlaying</code> prop을 갖고 있지 않습니다.
비디오 태그를 조작하는 방법은 DOM 앨리먼트의 <code>play()</code>와 <code>pause()</code>을 수동으로 부르는 것 뿐입니다.
<strong><code>isPlaying</code>prop의 값과 동기화를 시켜야 하고, isPlaying 은 <code>play()</code> 와 <code>pause()</code>를 선언적으로 호출해
현재 비디오를 실행<em>해야한다</em>는 것을 말해주어야합니다.</strong></p><p>먼저 <code>video</code> DOM 노드로부터 <a href="https://beta.reactjs.org/learn/manipulating-the-dom-with-refs" target="_blank" rel="noopener noreferrer">ref를 얻어야</a>
합니다.</p><p>렌더링하면서 <code>play()</code>나 <code>pause()</code>를 호출하고 싶은 마음이 들 수도 있지만, 그 방법은 옳지 않습니다:</p><div src="https://codesandbox.io/s/fjm8gc?file=/App.js&amp;utm_medium=sandpack"></div><p>이 코드가 틀린 이유는 렌더링하면서 DOM으로 무언가를 하려고 시도했기 때문입니다.
리액트에서는 <a href="https://beta.reactjs.org/learn/keeping-components-pure" target="_blank" rel="noopener noreferrer">렌더링은 JSX의 순수계산이어야만 하고</a>
DOM을 변경하거나 하는 부작용을 포함해서는 안됩니다.</p><p>더욱이, <code>VideoPlayer</code>가 처음으로 호출될 떄, 이 컴포넌트에 해당되는 DOM은 아직 존재하지 않습니다!
React는 JSX가 반환될 때까지 어떤 DOM이 생성될지 모르기 떄문에 <code>play()</code>나 <code>pause()</code>를 부를 DOM 노드가 아직 없습니다.</p><p>여기 해결책은 <strong>렌더링 계산 밖으로 코드를 가져와서 <code>useEffect</code>를 사용한 부작용으로 감싸주는 것입니다.</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> useRef </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">VideoPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> src</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> isPlaying </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ref </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">play</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pause</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">video ref</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">ref</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> src</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">src</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> loop playsInline </span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Effect에 DOM 업데이트를 감싸주면서, React가 화면을 먼저 업데이트하도록 해줄 수 있습니다.
그리고 나서 Effect가 돌아가죠.</p><p><code>VideoPlayer</code>컴포넌트가 렌더링될 때 (처음이거나 다시 렌더링되는 경우 중 하나).
몇 가지 일들이 일어날 수 있습니다.
먼저, React는 DOM안의 <code>&lt;video&gt;</code> 태그가 옳은 prop을 갖고 있는지 확인하면서 화면을 업데이트할 것입니다.
그리고 나서야 React는 Effect를 실행할 것입니다.
마지막으로, Effect가 <code>isPlaying</code> prop의 값에 따라 <code>play()</code>나 <code>pause()</code>를 부를 것입니다.</p><p>실행/멈춤을 여러번 눌러보고 비디오 플레이어가 어떻게 <code>isPlaying</code>값과 동기화되어서 작동하는지 확인해보세요.</p><div src="https://codesandbox.io/s/dvynjy?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>이 예시에서, React 상태와 동기화한 &quot;외부 시스템&quot;은 브라우저의 미디어 API였습니다.
여러분은 과거의 React가 아닌 코드(jQuery 플러그인과 같은)를 선언적인 React 컴포넌트로 감싸줄 때도 비슷한 접근을 사용할 수 있습니다.</p><p>비디오 플레이어를 조정하는 것은 실제로 훨씬 더 복잡하다는 것을 알아두세요. <code>play()</code> 호출이 실패할 수도 있고, 사용자가 브라우저의 내장된 컨트롤 기능을 사용해서 실행하거나 멈출 수도 있습니다.
이 예시는 매우 간소화된 것입니다.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>주의할 점</div><div class="admonitionContent_S0QG"><p>기본적으로 Effect는 매 렌더링 후에 돌아갑니다. 다음과 같은 코드가 왜 <strong>무한루프를 생성하는 지</strong>에 대한 이유입니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setCount</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">setCount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Effect는 렌더링의 <em>결과</em>를 실행합니다. 상태를 설정하는 것은 렌더링을 <em>유발</em>합니다.
Effect에서 직접적으로 상태를 설정하는 것은 동력 콘센트의 전원을 스스로에게 꽂는 것과 같습니다.
Effect가 동작하고, 상태를 설정하고, 리렌더링을 일으키고, Effect가 동작하고, 다시 상태를 설정하고 이와 같은 일이 반복해서 일어납니다.</p><p>Effect는 컴포넌트를 <em>외부</em> 시스템과 동기화해야합니다. 만약 외부 시스템이 없고 다른 상테에 기반한 몇 가지 상태를 변경하고 싶을 뿐이라면, <a href="https://beta.reactjs.org/learn/you-might-not-need-an-effect" target="_blank" rel="noopener noreferrer">Effect가 필요 없을 수도 있습니다.</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2단계-effect의-의존성을-명확히-하기">2단계: Effect의 의존성을 명확히 하기<a class="hash-link" href="#2단계-effect의-의존성을-명확히-하기" title="제목으로 바로 가기">​</a></h2><p>기본적으로, Effect는 <em>모든</em> 렌더링 후에 돌아갑니다. 종종 이는 <strong>원하는 바가 아닐 수</strong> 있습니다:</p><ul><li>가끔 이 동작은 느립니다. 외부 시스템과 동기화하는 것은 항상 즉각적이지 않기 떄문에 불필요하다면 넘어가고 싶을 수 있습니다.
예를 들어, 모든 키입력마다 채팅 서버를 재연결 하고 싶지는 않을 것입니다.</li><li>가끔 이 동작은 잘못되었습니다. 예를 들어, 모든 키입력마다 컴포넌트에 fade-in 애니메이션을 넣고 싶지 않을 수 있습니다.
이 에니메이션은 컴포넌트가 처음 나타날 때에만 동작해야 합니다.</li></ul><p>이 문제를 증명하기 위해, 몇몇 개의 <code>console.log</code> 호출과 부모 컴포넌트의 상태를 업데이트 하는 텍스트 입력이 있는 이전에 사용한 예시가 있습니다.
타이핑이 어떻게 Effect를 계속 돌아가게 하는지 확인해보세요:</p><div src="https://codesandbox.io/s/z1hxjk?file=%2FApp.js&amp;utm_medium=sandpack"></div><p><code>useEffect</code> 호출을 할 때 두 번쨰 인자로 의존성 배열을 명시해서 불필요하게 <strong>Effect를 다시 돌아가게 하는 것을 피하도록</strong> 할 수 있습니다.
위 예시의 14번쨰 줄에 빈 <code>[]</code> 배열을 추가하는 것으로 시작해보세요:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>React Hook useEffect has a missing dependency: &#x27;isPlaying&#x27;</code> 에러를 봐야합니다:</p><div src="https://codesandbox.io/s/dszumx?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>이 문제는 Effect 내부의 코드가 무엇을 할지 결정하기 위해 <code>isPlaying</code> prop에 <em>의존</em>하는 것입니다.
하지만 이 의존성은 명백하게 선언되지 않았습니다. 이 문제를 고치기 위해서는 의존성 배열에 <code>isPlaying</code>을 추가해보세요:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// It&#x27;s used here...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ...so it must be declared here!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이제 모든 의존성이 선업되었기 떄문에 에러가 없습니다. <code>[isPlaying]</code>을 의존성 배열로 명시하는 것은
만약 <code>isPlaying</code>이 이전 렌더링의 했을 떄와 같으면 Effect를 재실행하지 말라고 React에게 말해주는 것입니다.
이 변화로 입력창에 입력하는 것은 Effect가 다시 실행되는 것을 막아주지만 실행/멈춤을 누르면 여전히 Effecet가 동작합니다.</p><div src="https://codesandbox.io/s/6o7zyc?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>의존성 배열은 여러 개의 의존성을 갖고 있을 수 있습니다.
React는 이전 렌더링동안 갖고 있던 값과 비교해서 명시한 <em>모든</em> 의존성이 같으면 리렌더링을 하지 않습니다.
React는 <code>[Object.is](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is)</code> 비교를 사용해서 의존 값들을 비교합니다.
더 자세한 내용은 <a href="https://beta.reactjs.org/reference/react/useEffect#reference" target="_blank" rel="noopener noreferrer"><code>useEffect</code> API</a>를 확인해보세요.</p><p><strong>의존성을 &quot;선택&quot;할 수 없다는 것을 알아두세요.</strong> 만약 명시해놓은 의존성들과 React가 생각하는 Effect 내부의 코드에 기반한 의존성이 일치하지 않는다면 lint error를 얻게 될 것입니다.
이는 코드의 버그를 잡는 데 도움이 됩니다. Effect가 몇 개의 값들을 사용하지만 그 값들이 변할 떄 Effect가 돌아가길 원하지 <em>않는다</em>면, <a href="https://beta.reactjs.org/learn/lifecycle-of-reactive-effects#what-to-do-when-you-dont-want-to-re-synchronize" target="_blank" rel="noopener noreferrer">Effect코드가 그 의존성을 &quot;필요&quot;로 하지 않도록 직접 코드를 수정</a>해야 할 것입니다.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>주의할 점</div><div class="admonitionContent_S0QG"><p>의존성이 <em>없는</em>배열과 빈 <code>[]</code> 배열은 매우 다릅니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 모든 렌더링마다 동작합니다.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 마운트 될 때만 동작합니다. (컴포넌트가 나타날 떄)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 마운트 될 떄 *그리고 또* 지난 렌더링 이후로 a 또는 b가 변했을 때 동작합니다.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>다음 단계에서 &quot;마운트&quot;가 무엇을 의미하는지 더 자세히 알아 볼 것입니다. </p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>DEEP DIVE</div><div class="admonitionContent_S0QG"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="왜-ref는-의존성-배열에서-빠지나요">왜 ref는 의존성 배열에서 빠지나요?<a class="hash-link" href="#왜-ref는-의존성-배열에서-빠지나요" title="제목으로 바로 가기">​</a></h3><p>Effect는 <code>ref</code>와 <code>isPlaying</code> 둘 다 사용하고 있지만 <code>isPlaying</code>만 의존성 배열에 선언되어있습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">VideoPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> src</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> isPlaying </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ref </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">play</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pause</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이는 <code>ref</code>객체는 <em>안정적인 동일성</em>을 갖고 있기 때문입니다:
React는 모든 렌더링에서 <code>useRef</code>를 호출할 때 <a href="https://beta.reactjs.org/reference/react/useRef#returns" target="_blank" rel="noopener noreferrer">항상 같은 객체를 얻을 것</a>을 보장합니다.
그 객체는 절대 변하지 않기 때문에 Effect를 다시 실행하게 하지도 않을 것입니다.
따라서 ref 를 포함하는지 아닌지를 중요하지 않습니다. 포함해도 괜찮습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">VideoPlayer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> src</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> isPlaying </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ref </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useRef</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">play</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">pause</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isPlaying</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ref</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>useState</code>로 반환된 <a href="https://beta.reactjs.org/reference/react/useState#setstate" target="_blank" rel="noopener noreferrer"><code>set</code>함수</a>도 안정적인 동일성을 갖고 있기 떄문에 의존성에서 제외된 것을 종종 보게 될 것입니다.
만약 linter가 에러 없이 의존성에서 제외한다면 안전한 것입니다.</p><p>항상 안정적인 의존성을 제외하는 것은 linter 가 그 객체가 안정적이라는 것을 &quot;볼&quot; 수 있을 때만 가능합니다.
예를 들어, 만약 <code>ref</code>가 부모 컴포넌트로부터 전달된다면 의존성 배열에 명시해야 합니다.
왜냐하면 부모의 컴포넌트가 항상 같은 ref를 넘겨주는지, 아니면 여러개의 ref중의 하나를 조건부로 넘겨주는지 모를 수 있기 떄문에 명시하는 것이 좋습니다.
그래야만 Effect가 어떤 ref 가 전달되는 지 여부에 의존할 수 있습니다.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3단계-필요하다면-cleanup을-추가하세요">3단계: 필요하다면 cleanup을 추가하세요<a class="hash-link" href="#3단계-필요하다면-cleanup을-추가하세요" title="제목으로 바로 가기">​</a></h2><p>다른 예시를 고려해보세요. ChatRoom이 보일 떄마다 서버에 연결해야하는 <code>ChatRoom</code> 컴포넌트를 쓰고 있습니다.
여러분은 <code>connect()</code>와 <code>disconnect()</code>를 갖고 있는 객체를 돌려주는 API <code>createConnection()</code>을 받았습니다.
사용자에게 보여지는 동안 컴포넌트를 어떻게 연결된 상태로 유지할 수 있을까요?</p><p>Effect 로직을 쓰는 것부터 시작합시다:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">useEffect(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const connection = createConnection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connection.connect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>모든 리렌더링마다 채팅에 연결하는 것은 느리기 떄문에 의존성 배열을 추가해야합니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Effect 내부의 코드는 아무 prop이나 상태를 사용하지 않기 때문에 의존성 배열 <code>[]</code>(비어있음) 입니다.
이는 React가 컴포넌트가 &quot;마운트&quot;할 때만 이 코드를 실행한다는 것을 말해줍니다. 다른 말로 화면에 처음 나타날 때를 의미합니다.</strong></p><p>이 코드를 실행해봅시다:</p><div src="https://codesandbox.io/s/mgymtb?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>Effect는 마운트 시 한번만 동작하기 떄문에 콘솔창에 <code>&quot;✅ Connecting...&quot;</code>이 한 번만 출력될 것이라고 예상할 수도 있습니다.
<strong>하지만 콘솔을 확인해보면 <code>&quot;✅ Connecting...&quot;</code>은 두 번 출력됩니다. 왜 이런 일이 일어날까요?</strong></p><p><code>ChatRoom</code> 컴포넌트가 다른 많은 화면들을 가진 더 큰 앱의 일부라고 상상해보세요.
사용자는 <code>ChatRoom</code> 페이지에서 그들의 여행을 시작합니다. 컴포넌트는 마운트하고 <code>connection.connect()</code>를 부릅니다.
사용자가 다른 화면으로 이동한다고 생각해보세요- 예를 들어, 설정 화면이요. <code>Chatroom</code> 컴포넌트는 언마운트 될 것입니다.
마지막으로, 사용자가 뒤로가기를 클릭하고 <code>ChatRoom</code>이 다시 마운트됩니다.
이 마운트는 두 번째 연결을 만들 것입니다- 하지만 첫 번째 연결은 없어진 적이 없습니다!
사용자가 앱을 둘러볼 때, 연결은 계속 쌓이고 있었습니다.</p><p>이와 같은 버그는 수동 테스트를 많이 돌려보지 않는 이상 놓치기 쉽습니다.
빨리 발견하도록 하기 위해 React는 처음 마운트 한 후에 모든 컴포넌트를 다시 마운트 합니다.
<strong><code>&quot;✅ Connecting...&quot;</code> 로그를 두 번 보는 것은 진짜 문제를 확인할 수 있도록 도와줍니다: 코드가 컴포넌트가 언마운트 될 때 연결을 닫지 않고 있다는 것입니다.</strong></p><p>이 문제를 해결하기 위해, Effect에서 cleanup 함수를 돌려줍니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 Effect가 다시 실행되기 전에, 그리고 컴포넌트가 언마운트되는(제거되는) 마지막 시점에 cleanup 함수를 부를 것입니다.
cleanup 함수가 실행될 때 무엇이 일어나는지 확인해봅시다:</p><div src="https://codesandbox.io/s/58bmg8?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>이제 개발 환경에서 세 개의 콘솔 로그를 보게 됩니다:</p><ol><li><code>&quot;✅ 연결 중...&quot;</code></li><li><code>&quot;❌ 연결 해지됨.&quot;</code></li><li><code>&quot;✅ 연결 중...&quot;</code></li></ol><p><strong>이는 개발 환경에서 알맞은 동작입니다.</strong> 컴포넌트를 다시 마운트하면서 React는 앱을 돌아다니거나 뒤로 가는 것이 코드를 망가뜨리지 않았다는 것을 확인합니다.
연결을 해지하고 다시 연결하는 것은 정확하게 일어나야 할 일입니다! cleanup을 잘 구현할 때, Effect를 한번 돌리는 것과 Effect를 돌리고, cleanup함수를 돌리고, 다시 Effect를 실행하는 것 사이의 차이를 사용자가 볼 수 없어야 합니다.
React가 개발 환경에서 버그가 있는지 조사하고 있기 때문에 별도의 연결/연결 해지 호출 쌍이 있습니다.
이는 일반적인 일이기 때문에 없애려고 해서는 안됩니다.</p><p><strong>실제 환경에서는 <code>&quot;✅ 연결 중...&quot; </code>이 한번만 출력되는 것을 보실 수 있을 것입니다.</strong>
컴포넌트를 다시 마운트하는 것은 개발자가 cleanup이 필요한 Effect를 찾을 수 있도록 도와주기 위해서만 일어납니다.
개발 환경의 설정 중에서 <a href="https://beta.reactjs.org/reference/react/StrictMode" target="_blank" rel="noopener noreferrer">Strict Mode</a>를 끌 수도 있지만, 추천하지 않습니다.
이 설정은 위와 같은 많은 버그들을 찾을 수 있도록 해줍니다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="개발할-때-effect-가-두-번-실행되는-것을-어떻게-조절할까요">개발할 때 Effect 가 두 번 실행되는 것을 어떻게 조절할까요?<a class="hash-link" href="#개발할-때-effect-가-두-번-실행되는-것을-어떻게-조절할까요" title="제목으로 바로 가기">​</a></h2><p>React는 방금 전의 예시와 같은 버그를 찾도록 도와주기 위해 개발에서 컴포넌트를 의도적으로 다시 마운트합니다.
<strong>올바른 질문은 &quot;Effect를 어떻게 한 번만 실행할 수 있나요&quot;가 아니라 &quot;어떻게 Effect를 고쳐서 다시 마운트 된 후에도 동작하게끔 할 수 있나요&quot;입니다.</strong></p><p>일반적으로 답은 cleanup 함수를 실행하는 것입니다. cleanup 함수는 Effect가 무엇을 하든간에 상관없이 멈추거나 다시 이전의 상태로 돌려놓아야 합니다.
경험상 사용자는 Effect가 한 번 실행된 것(production 환경으로)과 실행 -&gt; cleanup-&gt; 실행의 순서(개발에서 볼 수 있듯이)를 눈치챌 수 없어야 합니다.</p><p>앞으로 사용하게 될 Effect의 대부분은 아래 패턴 중 하나에 해당할 것입니다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="react가-아닌-위젯을-조정하는-것">React가 아닌 위젯을 조정하는 것<a class="hash-link" href="#react가-아닌-위젯을-조정하는-것" title="제목으로 바로 가기">​</a></h3><p>가끔 React로 만들어지지 않은 UI 위젯을 추가할 필요가 있습니다. 예를 들어, 페이지에 지도 컴포넌트를 추가하고 싶다고 말해봅시다.
지도 컴포넌트는 <code>setZoomLevel()</code> 메소드를 갖고 있어야하고, React 코드 내부의 <code>zoomLevel</code>상태 변수와 동기화시키고 싶어할 것입니다.
Effect는 아래와 유사할 것입니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mapRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setZoomLevel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zoomLevel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zoomLevel</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이 경우에는 cleanup 함수가 필요없다는 것을 확인하세요. 개발에서 React는 Effect를 두 번 부르지만 같은 값을 가진 <code>setZoomLevel</code>을 두 번 부르는 것은 아무 것도 하지 않기 때문에 문제가 되지 않습니다.
살짝 느려질 수는 있지만 개발 환경에서만 다시 마운트하는 것이고 배포된 상황에서는 일어나지 않을 것이기 때문에 문제가 되지 않습니다.</p><p>몇몇 API는 연속으로 두 번 부르는 것을 혀용하지 않을 수 잇습니다. 예를 들어, 내장되어있는 <code>[&lt;dialog&gt;](https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement)</code> 엘리먼트의
<code>[showModal](https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/showModal)</code>을 두 번 부르면 에러를 던집니다. cleanup함수를 사용해서 dialog를 닫을 수 있습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dialog </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dialogRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dialog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">showModal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> dialog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>개발할 때, Effect는 <code>showModal()</code>을 부르고 나서 즉시<code>close()</code>를 부르고, <code>showModal()</code>을 다시 부를 것입니다.
이는 배포 환경에서 보게 되듯이 사용자 입장에서 <code>showModal()</code>을 한번 부른 것과 같습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="이벤트를-구독하는-것">이벤트를 구독하는 것<a class="hash-link" href="#이벤트를-구독하는-것" title="제목으로 바로 가기">​</a></h3><p>Effect가 무언가를 구독한다면 cleanup함수가 구독을 해지해야합니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleScroll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clientX</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clientY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;scroll&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleScroll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;scroll&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleScroll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>개발 환경에서, Effect는 <code>addEventListener()</code>를 부르고, 그 다음 즉시 <code>removeEventListener()</code>을 부른 다음, 다시 같은 핸들러로 <code>addEventListener()</code>를 호출합니다.
그래서 한번에 단 하나의 활성화된 구독만 있을 것입니다. 이는 사용자 입장에서 <code>addEventListener()</code>을 한번 부르는 것과 같은 행동이라는 것을 배포환경에서 볼 수 있을 것입니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="애니메이션-유발하기">애니메이션 유발하기<a class="hash-link" href="#애니메이션-유발하기" title="제목으로 바로 가기">​</a></h3><p>만약 Effect가 애니메이션을 넣는다면, cleanup 함수는 애니메이션을 초기값으로 리셋해야 합니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ref</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">opacity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 애니메이션을 유발합니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">opacity</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 초기값으로 리셋합니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>개발환경에서, 투명도는 <code>1</code>로 설정되었다가 <code>0</code>으로 되었다가, 다시 <code>1</code>이 됩니다.
운영 환경에서 바로 투명도를 1로 설정하는 것과 동일한 화면 동작을 사용자에게 보여주어야 합니다.
만약 여러분이 트윈 애니메이션을 제공하는 외부 애니메이션 라이브러리를 사용한다면, cleanup 함수는 트윈의 타임라인을 초기상태로 되돌려야 합니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="데이터-가져오기">데이터 가져오기<a class="hash-link" href="#데이터-가져오기" title="제목으로 바로 가기">​</a></h3><p>만약 Effect가 어떠한 데이터를 가져온다면, cleanup 함수는 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" rel="noopener noreferrer">가져오는 것을 중단</a>하거나 결과물을 무시해야 합니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> ignore </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startFetching</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetchTodos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">ignore</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">setTodos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">startFetching</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">userId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>여러분은 이미 발생한 네트워크 요청을 &quot;취소&quot;할 수 없지만, cleanup 함수는 <em>더이상 관련없는</em> 데이터 가져오기가 앱에 영향을 주는 것을 하지 못하도록 만들 수 있습니다.
예를 들어, 만약 <code>userId</code>가 <code>&#x27;Alice&#x27;</code>에서 <code>&#x27;Bob&#x27;</code>으로 변경된다면, cleanup 함수는 <code>&#x27;Bob&#x27;</code>으로 변경된 이후 도착하는 <code>&#x27;Alice&#x27;</code> 응답이 무시되도록 합니다.
<strong>개발환경에서, 네트워크 탭에서 두개의 데이터 가져오기를 볼 수 있습니다.</strong>
여기에는 어떤 오류도 없습니다.
이 접근법으로 위 예시를 보면, 첫번째 Effect는 즉시 제거될 것이고 <code>ignore</code> 변수는 <code>true</code>로 설정되어 있을 것입니다.
그래서 추가요청이 있더라도, <code>if (!ignore)</code> 조건 덕분에 추가요청은 상태에 영향을 끼치지 않을 것입니다.</p><p><strong>운영 환경에서, 한번의 요청만 있을 것입니다.</strong>
개발환경에서 두번째 요청이 여러분을 괴롭힌다면, 최선의 방법은 요청의 중복을 제거하고 컴포넌트들 간의 응답을 캐시하는 것이 가장 좋습니다.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">TodoList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> todos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useSomeDataLibrary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">/api/user/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">userId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/todos</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>개발경험을 향상시킬뿐만 아니라, 앱이 더 빠르게 동작하는 것처럼 느껴질 것입니다.
예를 들어, 뒤로가기 버튼을 눌렀을 때 데이터가 캐시되었기 때문에 사용자는 데이터가 다시 불러와지는 것을 기다릴 필요가 없습니다.
여러분이 캐시를 만들어 낼 수도 있고 또는 Effect를 이용해 수동으로 데이터를 가져오는 것의 여러 대체 방안들 중 하나를 사용할 수 있습니다.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Deep Dive</div><div class="admonitionContent_S0QG"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="effect에서-데이터를-가져오는-것을-대체할-다른-좋은-방안들이-있나요">Effect에서 데이터를 가져오는 것을 대체할 다른 좋은 방안들이 있나요?<a class="hash-link" href="#effect에서-데이터를-가져오는-것을-대체할-다른-좋은-방안들이-있나요" title="제목으로 바로 가기">​</a></h3><p>Effect 내부에서 <code>fetch</code>를 부르도록 코드를 작성하는 것은 <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noopener noreferrer">데이터를 가져오는 일반적인 방식</a>입니다. 특히, 완전한 client side 앱에서는 더욱 그렇습니다.
하지만, 매우 수동적인 접근 방식이며 아래와 같은 중요한 단점들을 가지고 있습니다:</p><ul><li><p><strong>Effect는 서버에서 실행되지 않습니다.</strong> 처음 서버에서 렌더된 HTML은 데이터가 없는 로딩중인 상태만을 가지고 있다는 것을 의미합니다.
사용자 컴퓨터는 모든 JavaScript를 다운로드하고 앱을 렌더해야만 데이터를 가져와야 하는지 판단할 수 있습니다. 이는 효율적이지 않습니다.</p></li><li><p><strong>Effect에서 바로 데이터를 가져오는 것은 &quot;네트워크 폭포&quot; 현상을 만들 수 있습니다.</strong> 부모 컴포넌트를 렌더링하고, 부모 컴포넌트가 어떤 데이터를 가져오고, 그리고나서 자식 컴포넌트들이 렌더링되고 자식 컴포넌트들은 각각의 데이터를 가져오기 시작합니다.
만약 네트워크가 빠르지 않다면, 병렬로 모든 데이터를 가져오는 것보다 매우 느릴 것입니다.</p></li><li><p><strong>Effect에서 바로 데이터를 가져오는 것은 보통 데이터를 미리 가져오거나 캐시할 수 없음을 의미합니다.</strong> 예를 들어, 컴포넌트가 마운트와 언마운트를 계속하면, 컴포넌트는 데이터를 반복해서 가져와야만 합니다.</p></li><li><p><strong>상당히 인체공학적이지 않습니다.</strong>  <a href="https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect" target="_blank" rel="noopener noreferrer">경쟁 상태</a>와 같은 오류들로부터 고통받지 않는 방식으로 <code>fetch</code>를 부르도록 작성하는 것을 포함해 약간의 보일러 플레이트가 존재합니다.</p></li></ul><p>이 일련의 단점들은 React에 한정되어 있지 않습니다. 어느 라이브러리에서든 마운트 시 데이터를 가져오도록 적용하고 있습니다.
라우팅처럼 데이터를 가져오는 것은 절대 사소한 부분이 아니므로 다음 접근법들을 추천하고 있습니다:</p><ul><li><p><strong><a href="https://beta.reactjs.org/learn/start-a-new-react-project#building-with-a-full-featured-framework" target="_blank" rel="noopener noreferrer">프레임워크</a>를 사용하고 있다면, 프레임워크에서 기본으로 제공하고 있는 데이터를 가져오는 방식을 사용하세요.</strong>
현대 React 프레임워크는 위의 주의사항들로부터 고통받지 않고 효율적인 데이터 가져오기 방식들을 통합해 왔습니다.</p></li><li><p><strong>사용자 측의 캐시를 사용하거나 만드는 것을 고려해 보세요.</strong> 인기 있는 오픈 소스 솔루션에는 <a href="https://tanstack.com/query/latest" target="_blank" rel="noopener noreferrer">React Query</a>, <!-- -->[useSWR]<a href="https://swr.vercel.app/ko" target="_blank" rel="noopener noreferrer">https://swr.vercel.app/ko</a>), 그리고 <a href="https://beta.reactrouter.com/en/main/start/overview" target="_blank" rel="noopener noreferrer">React Router 6.4</a> 등이 있습니다.
여러분은 여러분만의 솔루션을 만들 수 있습니다. 그 솔루션은 내부적으로 Effect를 사용하지만 요청을 중복해서 보내지 않고, 응답을 캐싱하고, 네트워크 폭포 현상을 피하는(경로에 데이터를 미리 로드하거나 데이터 요구사항들을 호이스팅함으로서) 로직이 추가되어 있는 경우입니다.</p></li></ul><p>여러분은 이 접근법들이 여러분에게 맞지 않다면 Effect에서 바로 데이터를 가져올 수 있습니다.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="분석-데이터-보내기">분석 데이터 보내기<a class="hash-link" href="#분석-데이터-보내기" title="제목으로 바로 가기">​</a></h3><p>페이지 방문 시 분석 데이터를 보내는 이벤트를 보내는 코드를 생각해 봅시다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">logVisit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// POST 요청을 보냅니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>개발 환경에서, <code>logVisit</code>은 모든 URL에 대해서 두번 불려서 여러분은 이를 해결하려고 시도해보았을 수도 있습니다.
<strong>이 코드를 유지하는 것을 추천드립니다.</strong>
이전의 예시들과 같이, 한 번 <code>logVisit</code>을 실행하는 것과 두 번 실행하는 것 사이에 사용자 화면에서는 차이가 없습니다.
실질적인 관점으로 <code>logVisit</code>은 개발환경에서 어떠한 것도 하면 안되는데 그 이유는 개발 환경에서의 로그가 운영 환경의 측정치들을 왜곡해서는 안되기 때문입니다.
파일을 저장할 때마다 컴포넌트는 재마운트하므로 개발 중에는 어떻게든 추가적인 방문 데이터를 보낼 것입니다.</p><p><strong>운영 환경에서는 중복된 방문 로그가 없을 것입니다.</strong></p><p>여러분이 보낸 분석 데이터를 디버깅하기 위해, 스테이징 환경(운영 환경과 거의 동일한 환경)에 배포하거나 <a href="https://beta.reactjs.org/reference/react/StrictMode" target="_blank" rel="noopener noreferrer">엄격 모드</a> 및 개발 전용의 재마운트를 잠시 해제할 수 있습니다.
Effect 대신에 라우트가 변경될 때 이벤트 핸들러를 통해 분석 데이터를 보낼 수 있습니다.
더 정확한 분석을 위해서, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API" target="_blank" rel="noopener noreferrer">intersection observer</a>가 화면 내 어떤 컴포넌트가 있고 얼마나 오랫동안 해당 영역이 보였는지 추적할 수 있게 도와줄 수 있습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="effect가-아닌-경우--앱을-초기화하기">Effect가 아닌 경우 : 앱을 초기화하기<a class="hash-link" href="#effect가-아닌-경우--앱을-초기화하기" title="제목으로 바로 가기">​</a></h3><p>일부 로직은 앱이 시작할 때 한번만 실행됩니다.
이 로직을 컴포넌트 밖에 놓을 수 있습니다.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 브라우저가 실행되고 있는지 확인합니다</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">checkAuthToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">loadDataFromLocalStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">App</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이 방식은 브라우저가 페이지에 로드한 이후 오직 한번만 로직이 실행되는 것을 보장합니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="effect가-아닌-경우--상품을-사기">Effect가 아닌 경우 : 상품을 사기<a class="hash-link" href="#effect가-아닌-경우--상품을-사기" title="제목으로 바로 가기">​</a></h3><p>가끔, 여러분이 cleanup 함수를 작성해도, Effect가 두 번 실행되어 나온 결과물을 사용자가 보지 못하도록 막을 수 없는 경우가 있습니다.
예를 들어, Effect가 상품을 구매 POST 요청을 보내는 것이 있습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 🔴 문제: 이 Effect는 개발환경에서 두 번 발동하고, 코드에서 문제를 일으킵니다.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/api/buy&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;POST&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>상품을 두 번 구매하고 싶지는 않을 것입니다. 그래서 여러분은 이 로직을 Effect에 넣어서는 안됩니다.
사용자가 다른 페이지로 갔다가 뒤로가기 버튼을 누른다면 어떻게 될까요? Effect는 다시 실행될 것입니다.
여러분은 사용자가 페이지를 <em>방문</em>할 때 상품을 구매하기를 원하지 않습니다. 사용자가 구매버튼을 <em>눌렀을</em> 때 상품을 구매하기를 원합니다</p><p>구매는 렌더링에 의해 발생하지 않습니다. 구매는 특정 상호작용에 의해 발생됩니다.
구매 상호작용(클릭)이 한번만 일어나기 때문에 구매는 오직 한 번만 실행되어야 합니다.
<strong>Effect를 제거하고 <code>/api/buy</code> 요청을 구매버튼의 이벤트 핸들러로 이동하세요.</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ 구매는 특정 상호작용에 의해 일어나기 때문에 구매는 이벤트입니다.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/api/buy&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;POST&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>재마운트가 여러분의 앱의 로직에 장애를 일으키면 이는 보통 존재하던 버그를 발견하는 것으로 볼 수 있습니다.
사용자 관점에서, 페이지를 방문하는 것은 페이지를 방문하고, 링크를 클릭하고, 뒤로가기 버튼을 누르는 것과 다르지 않아야 합니다.
React는 개발 환경에서 컴포넌트들을 다시 마운트시켜 컴포넌트들이 이 원리를 벗어나지 않는지 확인합니다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="effect에-모든-것을-함께-넣기">Effect에 모든 것을 함께 넣기<a class="hash-link" href="#effect에-모든-것을-함께-넣기" title="제목으로 바로 가기">​</a></h2><p>이 파트에서는 Effect가 실제로 어떻게 동작하는지에 대해 &quot;감을 느낄&quot; 수 있도록 도와줍니다.</p><p>아래 예시는 Effect가 실행되고나서 3초 후에 입력 문구가 콘솔에 나타나도록 만들기 위해 <a href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout" target="_blank" rel="noopener noreferrer"><code>setTimeout</code></a>을 사용합니다.
cleanup 함수는 취소합니다. &quot;컴포넌트 마운트하기&quot; 버튼을 눌러서 시작해보세요.</p><div src="https://codesandbox.io/s/4rybls?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>처음에 세 개의 로그를 볼 수 있을 것입니다: <code>Schedule &quot;a&quot; log</code>, <code>Cancel &quot;a&quot; log</code>, 그리고 다시 <code>Schedule &quot;a&quot; log</code>.
심초 후 로그는 <code>a</code>를 말합니다.
이 페이지에서 이미 배웠던 것처럼, 추가적인 스케줄/취소 쌍이 있는 이유는 <strong>React가 개발환경에서 제거를 잘 실행했는지 검증하기 위해 컴포넌트를 한 번 더 재마운트하기 때문입니다</strong>.</p><p>입력란에 <code>abc</code>를 입력해 보세요.
충분히 빠르게 입력한다면, <code>Schedule &quot;ab&quot; log</code> 다음에 <code>Cancel &quot;ab&quot; log</code>, <code>Schedule &quot;abc&quot; log</code>를 볼 수 있을 것입니다.
<strong>React는 항상 이전 렌더의 Effect를 다음 렌더의 Effect 전에 제거합니다.</strong>
여러분이 빠르게 입력하더라도 한 번에 최대 한 개의 timeout만이 예약되어 있는 이유입니다.
입력을 몇 번 수정해보고 어떻게 Effect가 제거되는지 감을 잡기 위해 console을 보면서 확인해 보세요.</p><p>입력에 어떤 것이든 입력하고나서 &quot;컴포넌트 언마운트하기&quot;를 누르세요.
<strong>언마운트가 마지막 렌더의 Effect를 어떻게 제거하는지 주목하세요.</strong>
이 예시에서, 언마운트 시 cleanup 함수를 통해 timeout이 실행되기 전에 마지막 timeout을 제거합니다.</p><p>마지막으로, timeout이 취소되지 않도록 위의 컴포넌트에서 cleanup 함수를 삭제해 보세요.
<code>abcde</code>를 빠르게 입력해 보세요.
여러분은 삼초 안에 무슨 일이 일어날지 예상하나요?
timeout 내부에 있는 <code>console.log(text)</code>가 <em>마지막</em> <code>text</code>를 프린트하고 다섯 개의 <code>abcde</code> 로그를 만들어낼까요?
여러분의 직관을 검사하기 위해 직접 시도해 보세요!</p><p>3초 후, 여러분은 다섯개의 <code>abcde</code> 로그가 아닌 일련의 로그들(<code>a</code>, <code>ab</code>, <code>abc</code>, <code>abcd</code>, 그리고 <code>abcde</code>)을 볼 것입니다.
<strong>각각의 Effect는 Effect에 대응하는 렌더에서 <code>text</code>를 &quot;잡아냅니다&quot;.</strong>
Effect는 <code>text</code> 상태가 변경한 것을 신경쓰지 않습니다. <code>text = &#x27;ab&#x27;</code>로 렌더링 됬을 때의 Effect는 항상 <code>&#x27;ab&#x27;</code>를 바라보고 있습니다.
즉, 각각의 렌더링에서 Effect는 서로 독립되어 있습니다.
만약 이 동작이 궁금하다면, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" rel="noopener noreferrer">closure</a>에 대해서 읽어보세요.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Deep Dive</div><div class="admonitionContent_S0QG"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="렌더는-각각-자신만의-effect를-가지고-있다">렌더는 각각 자신만의 Effect를 가지고 있다<a class="hash-link" href="#렌더는-각각-자신만의-effect를-가지고-있다" title="제목으로 바로 가기">​</a></h2><p>렌더의 결과물에 행동의 조각을 &quot;붙이는&quot; 것으로 <code>useEffect</code>를 생각할 수 있습니다. 아래 Effect 예시를 고려해 볼 수 있습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">ChatRoom</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter"> roomId </span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roomId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">roomId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Welcome</span><span class="token plain"> to </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">roomId</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>사용자가 앱을 탐색하면서 무슨 일이 일어나는지 정확하게 알아봅시다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="초기-렌더링">초기 렌더링<a class="hash-link" href="#초기-렌더링" title="제목으로 바로 가기">​</a></h3><p>사용자는 <code>&lt;ChatRoom roomId=&quot;general&quot; /&gt;</code>을 방문합니다. <code>roomId</code>가 <code>&#x27;general&#x27;</code>이란 값을 가졌다고 <a href="https://beta.reactjs.org/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time" target="_blank" rel="noopener noreferrer">가정해 봅시다</a>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 첫번째 렌더링에서의 JSX 결과 (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Welcome</span><span class="token plain"> to general</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Effect는 렌더링 결과물의 일부이기도 합니다.</strong> 첫번째 렌더링의 Effect는 아래와 같이 됩니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 첫번째 렌더링에서의 Effect (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;general&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 첫번쨰 렌더링에서의 의존성 (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;general&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 <code>&#x27;general&#x27;</code> 채팅방을 연결하는 Effect를 실행합니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="같은-의존성을-가진-리렌더링">같은 의존성을 가진 리렌더링<a class="hash-link" href="#같은-의존성을-가진-리렌더링" title="제목으로 바로 가기">​</a></h3><p><code>&lt;ChatRoom roomId=&quot;general&quot; /&gt;</code>는 리렌더링이 일어났다고 해봅시다. JSX 결과는 똑같습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 두번째 렌더링에서의 JSX 결과 (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Welcome</span><span class="token plain"> to general</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 렌더링 결과물이 변하지 않았다고 보고, React는 DOM을 업데이트하지 않습니다.</p><p>두번째 렌더링에서의 Effect는 아래와 같습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 두번째 렌더링에서의 Effect  (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;general&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 두번쨰 렌더링에서의 의존성 (roomId = &quot;general&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;general&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 첫번째 렌더링에서의 <code>[&#x27;general&#x27;]</code>과 두번째 렌더링에서의 <code>[&#x27;general&#x27;]</code>을 비교합니다.
<strong>모든 의존성이 같기 때문에, React는 두번째 렌더링에서 Effect를 <em>무시</em>합니다.</strong> Effect는 다시 불리지 않습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="다른-의존성을-가진-리렌더링">다른 의존성을 가진 리렌더링<a class="hash-link" href="#다른-의존성을-가진-리렌더링" title="제목으로 바로 가기">​</a></h3><p>사용자가 <code>&lt;ChatRoom roomId=&quot;travel&quot; /&gt;</code>를 방문합니다. 이번에는 컴포넌트가 다른 JSX를 반환합니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 세번째 렌더링에서의 JSX 결과 (roomId = &quot;travel&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token maybe-class-name">Welcome</span><span class="token plain"> to travel</span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">h1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 <code>&quot;Welcome to general&quot;</code>에서 <code>&quot;Welcome to travel&quot;</code>으로 바뀌도록 DOM을 업데이트합니다.</p><p>세번째 렌더링에서의 Effect는 아래와 같습니다:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 세번째 렌더링에서의 Effect (roomId = &quot;travel&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;travel&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 세번쨰 렌더링에서의 의존성 (roomId = &quot;travel&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;travel&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>React는 첫번째 렌더링에서의 <code>[&#x27;general&#x27;]</code>과 세번째 렌더링에서의 <code>[&#x27;travel&#x27;]</code>을 비교합니다.
<code>Object.is(&#x27;travel&#x27;, &#x27;general&#x27;)</code>가 <code>false</code>이기 때문에 의존성이 다릅니다. Effect는 생략되지 않습니다.</p><p><strong>세번째 렌더링에서 React가 Effect를 적용하기 전에, React는 마지막으로 실행<em>되었던</em> Effect를 제거할 필요가 있습니다.</strong>
두번째 렌더의 Effect는 생략되었으므로 React는 첫번째 렌더의 Effect를 제거할 필요가 있습니다.
첫번째 렌더 부분으로 스크롤을 올려보면, 여러분은 첫번째 렌더의 cleanup 함수가 <code>createConnection(&#x27;general&#x27;)</code>로 생성된 커넥션에서 <code>disconnect()</code>를 실행하는 것을 볼 수 있습니다.
이는 <code>&#x27;general&#x27;</code> 채팅 방에서 앱과의 연결을 끊는 것입니다.</p><p>그 후 React는 세번째 렌더링의 Effect를 실행합니다. 이 Effect는 <code>&#x27;travel&#x27;</code> 채팅 방을 연결합니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="언마운트">언마운트<a class="hash-link" href="#언마운트" title="제목으로 바로 가기">​</a></h3><p>마지막으로, 사용자가 떠나고나서 <code>ChatRoom</code> 컴포넌트가 언마운트된다고 가정해 봅시다.
React는 마지막 Effect의 cleanup 함수를 실행합니다. 마지막 Effect는 세번째 렌더에서 발생했던 것입니다.
세번째 렌더의 cleanup 함수는 <code>createConnection(&#x27;travel&#x27;)</code> 커넥션을 파괴합니다. 따라서 앱은 <code>&#x27;travel&#x27;</code> 방과 연결을 끊습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="개발환경에서의-동작들">개발환경에서의 동작들<a class="hash-link" href="#개발환경에서의-동작들" title="제목으로 바로 가기">​</a></h3><p><a href="https://beta.reactjs.org/reference/react/StrictMode" target="_blank" rel="noopener noreferrer">엄격 모드</a>가 켜져있을 때, React는 마운트 이후 모든 컴포넌트를 한 번 더 마운트합니다. (상태와 DOM은 보존됩니다.)
이 동작은 경쟁 상태와 같은 오류를 빠르게 노출시키고 <a href="https://beta.reactjs.org/learn/synchronizing-with-effects#step-3-add-cleanup-if-needed" target="_blank" rel="noopener noreferrer">여러분이 cleanup 함수가 필요한 Effect를 찾아내는 데 도움을 줍니다</a>.
추가로, React는 개발환경에서 파일을 저장할 때마다 Effect를 다시 마운트합니다. 이 두 동작들은 모두 개발환경에만 있습니다.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="되짚어보기">되짚어보기<a class="hash-link" href="#되짚어보기" title="제목으로 바로 가기">​</a></h2><ul><li>이벤트와는 다르게, Effect는 특정 상호작용보다는 렌더링에 의해서 발생합니다.</li><li>Effect는 몇몇 외부 시스템(제 3의 API, 네트워크, 등)과 컴포넌트를 동기화해줍니다.</li><li>기본적으로, Effect는 매 렌더 이후 실행됩니다(초기의 렌더를 포함해서).</li><li>React는 마지막 렌더동안 Effect의 의존성이 같은 값을 가지고 있다면 Effect를 생략합니다.</li><li>여러분은 의존성을 &quot;선택&quot;할 수 없습니다. 의존성은 Effect 내부의 코드로 결정되어집니다.</li><li>빈 의존성 배열(<code>[]</code>)은 컴포넌트의 &quot;마운팅&quot;(화면에 추가되는 순간)과 대응됩니다.</li><li>엄격 모드가 켜 있을 때에는 React가 Effect를 스트레스 테스트하기 위해 컴포넌트를 두 번 마운트합니다. (오직 개발환경에서만!)</li><li>Effect가 재마운팅 때문에 문제가 생겼다면, cleanup 함수 실행을 넣어야 합니다.</li><li>React는 다음 Effect가 실행되기 전과 언마운트 동안 cleanup 함수를 부릅니다.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>문제에 도전해보세요</div><div class="admonitionContent_S0QG"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-마운트-시-필드에-포커스를-둡니다">1. 마운트 시 필드에 포커스를 둡니다<a class="hash-link" href="#1-마운트-시-필드에-포커스를-둡니다" title="제목으로 바로 가기">​</a></h2><p>아래 예시에서, 폼은 <code>&lt;MyInput /&gt;</code> 컴포넌트를 렌더링합니다.</p><p><code>MyInput</code>이 화면에 나타날 때 <code>MyInput</code>이 자동으로 포커싱되도록 하기 위해 input의 <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus" target="_blank" rel="noopener noreferrer"><code>focus()</code></a> 방법을 사용하세요.
이미 주석처리되어 실행되지 않지만 실제로도 동작하지 않습니다. 왜 동작하지 않는지 알아내고 고쳐보세요.
(<code>autoFocus</code> 속성에 친숙하다면, 해당 속성이 존재하지 않다고 가정해 주세요. 밑바닥부터 같은 기능을 만들려 합니다.)</p><div src="https://codesandbox.io/s/uy289j?file=%2FMyInput.js&amp;utm_medium=sandpack"></div><p>여러분의 해결책이 동작한다는 것을 증명하기 위해, &quot;폼 보이기&quot; 버튼을 누르고 입력란이 포커싱을 받는지 확인해 보세요(하이라이트 처리되고 커서가 입력란 내부에 위치해 있습니다).
&quot;폼 숨기기&quot;와 &quot;폼 보이기&quot; 버튼을 다시 눌러보세요. 입력란이 다시 하이라이팅되는지 확인하세요.</p><p><code>MyInput</code>은 모든 렌더링이 아닌 <em>마운트</em>에만 포커싱되어야 합니다. 동작이 올바르다는 것을 증명하기 위해, &quot;폼 보이기&quot; 버튼을 누르고나서 반복적으로 &quot;대문자로 만들기&quot; 체크박스를 눌러보세요.
체크박스를 누르면 입력란에 포커싱이 되어서는 <em>안됩니다</em>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정답">정답<a class="hash-link" href="#정답" title="제목으로 바로 가기">​</a></h3><p>렌더링 동안 <code>ref.current.focus()</code>를 부르는 것은  <code>ref.current.focus()</code>가 <em>사이드 이펙트</em>이기 때문에 잘못됐습니다.
사이드 이펙트는 이벤트 핸들러 내부에 위치해 있거나 <code>useEffect</code>와 함께 선언되어야 합니다. 이 경우에, 사이드 이펙트는 어떤 특정한 상호작용이 아닌 컴포넌트의 나타남으로 <em>발생되므로</em>, 사이드 이펙트를 Effect 내부에 넣는 것이 말이 됩니다.</p><p>오류를 고치기 위해, <code>ref.current.focus()</code>를 Effect로 감싸야 합니다. 그리고 나서 이 Effect가 매 렌더링이 아닌 마운트 시에만 실행도록 하기 위해 빈 배열인 <code>[]</code> 의존성을 Effect에 추가합니다.</p><div src="https://codesandbox.io/s/ej8om1?file=%2FMyInput.js&amp;utm_medium=sandpack"></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-조건에-맞게-필드에-포커스를-둡니다">2. 조건에 맞게 필드에 포커스를 둡니다<a class="hash-link" href="#2-조건에-맞게-필드에-포커스를-둡니다" title="제목으로 바로 가기">​</a></h2><p>아래 폼은 두개의 <code>&lt;MyInput /&gt;</code> 컴포넌트를 렌더링합니다.</p><p>&quot;폼 보이기&quot; 버튼을 누르고 두번째 필드가 자동으로 포커싱되는 것에 주목하세요. 두 개의 <code>&lt;MyInput /&gt;</code> 컴포넌트가 필드를 포커스하려고 시도하기 때문입니다.
여러분이 연속된 두 개의 입력필드에 <code>focus()</code>를 부르면, 마지막 필드가 항상 &quot;이깁니다&quot;.</p><p>첫번째 필드에 포커스를 두고 싶다고 가정해 봅시다. 첫번째 <code>MyInput</code> 컴포넌트는 <code>true</code>로 설정된 boolean <code>shouldFocus</code> prop을 현재 받고 있습니다.
<code>MyInput</code>에서 <code>shouldFocus</code> prop이 <code>true</code>인 경우에만 <code>focus()</code>가 불리도록 로직을 변경해봅시다.</p><div src="https://codesandbox.io/s/uqfl1d?file=%2FMyInput.js&amp;utm_medium=sandpack"></div><p>여러분의 해결책을 확인하기 위해서, &quot;폼 보이기&quot;와 &quot;폼 숨기기&quot;를 반복적으로 눌러보세요.
폼이 나타날 때, <em>첫번째</em> 입력란만 포커싱이 되어야 합니다. 첫번째 입력란은 <code>shouldFocus={true}</code>를 가졌고 두번째 입력란은 <code>shouldFocus={false}</code>를 가진채로 부모 컴포넌트가 렌더링하기 때문입니다.
또한 두 개의 입력란들이 모두 동작하고 여러분이 입력이 가능한지 확인해 보세요.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="힌트">힌트<a class="hash-link" href="#힌트" title="제목으로 바로 가기">​</a></h3><p>여러분은 Effect를 조건에 맞게 선언할 수 없지만 Effect는 조건 로직을 포함할 수 있습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정답-1">정답<a class="hash-link" href="#정답-1" title="제목으로 바로 가기">​</a></h3><p>Effect 내부에 조건 로직을 넣으세요. Effect 내부에 <code>shouldFocus</code>를 사용하기 때문에 의존성에 <code>shouldFocus</code>를 넣을 필요가 있습니다.
(이는 몇몇 입력란의 <code>shouldFocus</code>가 <code>false</code>에서 <code>true</code>로 바뀐다면, 마운트 이후 입력란은 포커스될 것을 의미합니다.)</p><div src="https://codesandbox.io/s/rhxxow?file=%2FMyInput.js&amp;utm_medium=sandpack"></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-두-번-실행되는-interval를-수정합니다">3. 두 번 실행되는 interval를 수정합니다<a class="hash-link" href="#3-두-번-실행되는-interval를-수정합니다" title="제목으로 바로 가기">​</a></h2><p><code>Counter</code> 컴포넌트는 매초 증가하는 카운터를 보여줍니다.
마운트 되었을 때, <code>Counter</code> 컴포넌트는 <a href="https://developer.mozilla.org/en-US/docs/Web/API/setInterval" target="_blank" rel="noopener noreferrer"><code>setInterval</code></a>를 부릅니다.
<code>setInterval</code>은 매초 <code>onTick</code>이 실행되도록 합니다. <code>onTick</code> 함수는 카운터를 증가시킵니다.</p><p>하지만, 매초 한번만 증가시키는 것 대신에 두 번 증가시킵니다. 왜 이런 현상이 일어나는 걸까요?
오류의 원인을 밝혀내고 고쳐보세요.</p><div src="https://codesandbox.io/s/sv75dd?file=%2FCounter.js&amp;utm_medium=sandpack"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="힌트-1">힌트<a class="hash-link" href="#힌트-1" title="제목으로 바로 가기">​</a></h3><p><code>setInterval</code>은 interval ID를 반환한다는 것을 유념하세요.
따라서 여러분은 interval을 멈추기 위해 <a href="https://developer.mozilla.org/en-US/docs/Web/API/clearInterval" target="_blank" rel="noopener noreferrer"><code>clearInterval</code></a>를 넘길 수 있습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정답-2">정답<a class="hash-link" href="#정답-2" title="제목으로 바로 가기">​</a></h3><p><a href="https://beta.reactjs.org/reference/react/StrictMode" target="_blank" rel="noopener noreferrer">엄격 모드</a>가 켜져있을 때(이 사이트에 있는 sandbox 안의 코드처럼), React는 개발환경에서 한 번 더 각각의 컴포넌트를 마운트합니다.
이 엄격 모드가 interval이 두 번 실행되도록 만들었고 매초 counter가 두 번 증가한 이유입니다.</p><p>하지만, React의 동작은 오류의 <em>원인</em>이 아닙니다. 오류는 이미 코드에 있었습니다.
React의 동작은 오류를 더 잘 찾을 수 있도록 만들었습니다. 실제 원인은 이 Effect가 프로세스를 시작하지만 Effect를 제거하는 방식이 제공되어 있지 않습니다.</p><p>이 코드를 수정하기 위해, <code>setInterval</code>에서 반환된 interval ID를 저장하고 <a href="https://developer.mozilla.org/en-US/docs/Web/API/clearInterval" target="_blank" rel="noopener noreferrer"><code>clearInterval</code></a>를 이용한 cleanup 함수를 실행합니다.</p><div src="https://codesandbox.io/s/o25bp3?file=%2FCounter.js&amp;utm_medium=sandpack"></div><p>개발환경에서, React는 여러분이 제거를 잘 실행했는지 확인하기 위해 컴포넌트를 한 번 더 마운트할 것입니다.
따라서 <code>setInterval</code>이 불린다면, 즉시 <code>clearInterval</code>도 불리우고, 다시 <code>setInterval</code>이 불립니다.
운영환경에서는 오직 한번만 <code>setInterval</code>이 불립니다.
두 경우 모두 사용자가 바라보는 측면에서는 같습니다. 카운터는 매초 증가합니다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-effect-내부의-데이터-가져오기를-수정합니다">4. Effect 내부의 데이터 가져오기를 수정합니다<a class="hash-link" href="#4-effect-내부의-데이터-가져오기를-수정합니다" title="제목으로 바로 가기">​</a></h2><p>아래 컴포넌트는 선택된 사람의 전기를 보여줍니다.
컴포넌트는 마운트될 때와 <code>person</code>이 변경될 때마다 비동기 함수인 <code>fetchBio(person)</code>를 불러서 전기를 가져옵니다
비동기 함수는 결국 문자열을 주는 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer"><code>Promise</code></a>를 반환합니다.
데이터 가져오기가 끝났을 때, 컴포넌트는 <code>setBio</code>를 불러서 선택 상자 아래에 문자를 나타냅니다.</p><div src="https://codesandbox.io/s/vm6oex?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>이 코드에는 오류가 있습니다. &quot;Alice&quot;를 선택해 보세요. 그리고나서 &quot;Bob&quot;을 선택하고 바로 즉시 &quot;Taylor&quot;를 선택하세요.
충분히 빠르게 작업한다면, 여러분은 오류를 발견할 수 있을 것입니다. Taylor가 선택되었지만 &quot;This is Bob’s bio.&quot;라고 쓰여 있습니다.</p><p>왜 이런 일이 일어났을까요? Effect 내부에서 오류를 수정해 보세요.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="힌트-2">힌트<a class="hash-link" href="#힌트-2" title="제목으로 바로 가기">​</a></h3><p>만약 Effect가 비동기적으로 무언가를 가져온다면, 보통 cleanup 함수가 필요합니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정답-3">정답<a class="hash-link" href="#정답-3" title="제목으로 바로 가기">​</a></h3><p>오류를 발생하기 위해서는 아래 순서로 실행해야 합니다.</p><ul><li><code>&#x27;Bob&#x27;</code>을 선택하면 <code>fetchBio(&#x27;Bob&#x27;)</code>가 실행됩니다</li><li><code>&#x27;Taylor&#x27;</code>을 선택하면 <code>fetchBio(&#x27;Taylor&#x27;)</code>가 실행됩니다</li><li><strong><code>&#x27;Bob&#x27;</code> 데이터를 가져오기 전에 <code>&#x27;Taylor&#x27;</code> 데이터를 가져오는 것을 완료합니다</strong></li><li><code>&#x27;Taylor&#x27;</code> 렌더링의 Effect가 <code>setBio(&#x27;This is Taylor’s bio&#x27;)</code>를 실행합니다</li><li><code>&#x27;Bob&#x27;</code> 데이터를 가져오는 것이 완료됩니다</li><li><code>&#x27;Bob&#x27;</code> 렌더링의 Effect가 <code>setBio(&#x27;This is Bob’s bio&#x27;)</code>를 실행합니다</li></ul><p>Taylor가 선택되었지만 Bob의 전기가 보여진 이유입니다. 이런 오류들을 <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank" rel="noopener noreferrer">경쟁 상태</a>라고 부릅니다.
두 개의 비동기 동작들이 서로 &quot;경쟁&quot;하며 예상하지 못한 순서로 도착하기 때문입니다.</p><p>이 경쟁상태를 고치기 위해서 cleanup 함수를 추가해야 합니다.</p><div src="https://codesandbox.io/s/43lcvp?file=%2FApp.js&amp;utm_medium=sandpack"></div><p>각각의 렌더 Effect는 자신만의 <code>ignore</code> 변수를 가지고 있습니다.
초기에 <code>ignore</code> 변수는 <code>false</code>로 설정되어 있습니다.
하지만, Effect가 삭제되고(여러분이 다른 사람을 선택했을 때와 같이), Effect의 <code>ignore</code> 변수가 <code>true</code>가 되었습니다.
따라서 이제 요청이 완료되는 순서가 중요하지 않습니다. 마지막 사람의 Effect만 <code>ignore</code>이 <code>false</code>로 설정되어 있어 <code>setBio(result)</code>를 부를 것입니다.
과거의 Effect들은 제거되었으므로 <code>if (!ignore)</code>이 <code>setBio</code>를 부르는 것을 막을 것입니다.</p><ul><li><code>&#x27;Bob&#x27;</code>을 선택하면 <code>fetchBio(&#x27;Bob&#x27;)</code>가 실행됩니다</li><li><code>&#x27;Taylor&#x27;</code>을 선택하면 <code>fetchBio(&#x27;Taylor&#x27;)</code>가 실행되고 <strong>이전의 (Bob의) Effect를 제거합니다</strong></li><li><code>&#x27;Bob&#x27;</code> 데이터를 가져오기 전에 <code>&#x27;Taylor&#x27;</code> 데이터를 가져오는 것을 완료합니다</li><li><code>&#x27;Taylor&#x27;</code> 렌더링의 Effect가 <code>setBio(&#x27;This is Taylor’s bio&#x27;)</code>를 실행합니다</li><li><code>&#x27;Bob&#x27;</code> 데이터를 가져오는 것이 완료됩니다</li><li><code>&#x27;Bob&#x27;</code> 렌더링의 Effect는 <strong><code>ignore</code>이 <code>true</code>로 설정되어 있기 때문에 아무것도 하지 않습니다</strong></li></ul><p>추가로 오래된 API 요청의 결과를 무시하기 위해, 여러분은 더이상 필요하지 않은 요청들을 취소하는 <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" target="_blank" rel="noopener noreferrer"><code>AbortController</code></a>를 사용할 수 있습니다.
하지만, <code>AbortController</code>만으로 경쟁상태를 막기에는 부족합니다.
더 많은 비동기 단계들이 데이터 가져오기 이후 연결되어있을 수 있습니다. 따라서 <code>ignore</code>와 같은 명시적인 플래그를 사용하는 것이 이러한 유형의 문제들을 해결하는 가장 신뢰할 수 있는 방식입니다.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/line-next-level/React-Docs-KOR/tree/main/docs/learn/Escape Hatches/synchronizing-with-effects.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="문서 탐색"><a class="pagination-nav__link pagination-nav__link--prev" href="/React-Docs-KOR/docs/learn/Escape Hatches/manipulating-the-dom-with-refs"><div class="pagination-nav__sublabel">이전</div><div class="pagination-nav__label">Ref를 사용해 돔 조작하기</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/React-Docs-KOR/docs/learn/Escape Hatches/you-might-not-need-an-effect"><div class="pagination-nav__sublabel">다음</div><div class="pagination-nav__label">Effect가 필요하지 않을 가능성</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#effects는-무엇이고-이벤트와-어떻게-다를까요" class="table-of-contents__link toc-highlight">Effects는 무엇이고 이벤트와 어떻게 다를까요?</a></li><li><a href="#effect가-필요-없을-수도-있습니다" class="table-of-contents__link toc-highlight">Effect가 필요 없을 수도 있습니다.</a></li><li><a href="#effect를-작성하는-방법" class="table-of-contents__link toc-highlight">Effect를 작성하는 방법</a></li><li><a href="#1단계-effect를-선언하세요" class="table-of-contents__link toc-highlight">1단계: Effect를 선언하세요.</a></li><li><a href="#2단계-effect의-의존성을-명확히-하기" class="table-of-contents__link toc-highlight">2단계: Effect의 의존성을 명확히 하기</a></li><li><a href="#3단계-필요하다면-cleanup을-추가하세요" class="table-of-contents__link toc-highlight">3단계: 필요하다면 cleanup을 추가하세요</a></li><li><a href="#개발할-때-effect-가-두-번-실행되는-것을-어떻게-조절할까요" class="table-of-contents__link toc-highlight">개발할 때 Effect 가 두 번 실행되는 것을 어떻게 조절할까요?</a><ul><li><a href="#react가-아닌-위젯을-조정하는-것" class="table-of-contents__link toc-highlight">React가 아닌 위젯을 조정하는 것</a></li><li><a href="#이벤트를-구독하는-것" class="table-of-contents__link toc-highlight">이벤트를 구독하는 것</a></li><li><a href="#애니메이션-유발하기" class="table-of-contents__link toc-highlight">애니메이션 유발하기</a></li><li><a href="#데이터-가져오기" class="table-of-contents__link toc-highlight">데이터 가져오기</a></li><li><a href="#분석-데이터-보내기" class="table-of-contents__link toc-highlight">분석 데이터 보내기</a></li><li><a href="#effect가-아닌-경우--앱을-초기화하기" class="table-of-contents__link toc-highlight">Effect가 아닌 경우 : 앱을 초기화하기</a></li><li><a href="#effect가-아닌-경우--상품을-사기" class="table-of-contents__link toc-highlight">Effect가 아닌 경우 : 상품을 사기</a></li></ul></li><li><a href="#effect에-모든-것을-함께-넣기" class="table-of-contents__link toc-highlight">Effect에 모든 것을 함께 넣기</a></li><li><a href="#되짚어보기" class="table-of-contents__link toc-highlight">되짚어보기</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/React-Docs-KOR/assets/js/runtime~main.16dcfed8.js"></script>
<script src="/React-Docs-KOR/assets/js/main.ae80d2f5.js"></script>
</body>
</html>